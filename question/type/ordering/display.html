<?php
if (empty($CFG->orderingquestiontypeflag)) {
$CFG->orderingquestiontypeflag = 1;
?>
<link rel="stylesheet" href="<?php echo $CFG->wwwroot . "/question/type/ordering/"; ?>dd_files/lists.css" type="text/css">
<script language="JavaScript" type="text/javascript" src="<?php echo $CFG->wwwroot . "/question/type/ordering/"; ?>dd_files/coordinates.js"></script>
<script language="JavaScript" type="text/javascript" src="<?php echo $CFG->wwwroot . "/question/type/ordering/"; ?>dd_files/drag.js"></script>
<script language="JavaScript" type="text/javascript" src="<?php echo $CFG->wwwroot . "/question/type/ordering/"; ?>dd_files/dragdrop.js"></script>
<?php
}
?>
<script language="JavaScript" type="text/javascript"><!--
       function confirm(z)
       {
          window.status = 'Sajax version updated';
       }

        function onDrop_<?php echo $question->id; ?>() {
          var data_<?php echo $question->id; ?> = DragDrop.serData('g_<?php echo $question->id; ?>'); 
          x_sajax_update(data_<?php echo $question->id; ?>, confirm);
       }

       function onneedrun_<?php echo $question->id; ?>() {
        
           var list_<?php echo $question->id; ?> = document.getElementById("ordering");
           DragDrop.makeListContainer( list_<?php echo $question->id; ?>, 'g_<?php echo $question->id; ?>' );
           list_<?php echo $question->id; ?>.onDragOver = function() { this.style["background"] = "#EEF"; };
           list_<?php echo $question->id; ?>.onDragOut = function() {this.style["background"] = "none"; };
              
       }
        
        function getSort_<?php echo $question->id; ?>()
        {
          <?php echo $question->name_prefix; ?> = document.getElementById("<?php echo $question->name_prefix; ?>");
          <?php echo $question->name_prefix; ?>.value = DragDrop.serData('g_<?php echo $question->id; ?>', null);
        }
        
        function showValue_<?php echo $question->id; ?>()
        {
          <?php echo $question->name_prefix ?> = document.getElementById("<?php echo $question->name_prefix; ?>");
          alert(<?php echo $question->name_prefix; ?>.value);
        }
        
	//-->
</script>

<script type="text/javascript"> 

function touchHandler(event)
{
    var touches = event.changedTouches,
        first = touches[0],
        type = "";
        
    
    switch(event.type)
    {
        case "touchstart":
            type = "mousedown";
            break;
            
        case "touchmove":
            type="mousemove";        
            event.preventDefault();
            break;        
            
        case "touchend":
            type="mouseup";
            break;
            
        default:
            return;
    }
    
    var simulatedEvent = document.createEvent("MouseEvent");
    
    //initMouseEvent(type, canBubble, cancelable, view, clickCount, screenX, screenY, clientX, clientY, 
    //               ctrlKey, altKey, shiftKey, metaKey, button, relatedTarget);
    
    simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY,
                                  false, false, false, false, 0/*left*/, null);
                                                                            
    first.target.dispatchEvent(simulatedEvent);
 
    event.preventDefault();
}
 
function init() {
    for(i=0;i<document.getElementById("ordering").childNodes.length;i++) {
      document.getElementById('ordering').childNodes.item(i).addEventListener("touchstart", touchHandler, false);
      document.getElementById('ordering').childNodes.item(i).addEventListener("touchmove", touchHandler, false);
      document.getElementById('ordering').childNodes.item(i).addEventListener("touchend", touchHandler, false);
      document.getElementById('ordering').childNodes.item(i).addEventListener("touchcancel", touchHandler, false);
    }

    
    var myInterval = window.setInterval(function (a,b) {
function touchHandler(event)
{
    var touches = event.changedTouches,
        first = touches[0],
        type = "";
        
    
    switch(event.type)
    {
        case "touchstart":
            type = "mousedown";
            break;
            
        case "touchmove":
            type="mousemove";        
            event.preventDefault();
            break;        
            
        case "touchend":
            type="mouseup";
            break;
            
        default:
            return;
    }
    
    var simulatedEvent = document.createEvent("MouseEvent");
    
    //initMouseEvent(type, canBubble, cancelable, view, clickCount, screenX, screenY, clientX, clientY, 
    //               ctrlKey, altKey, shiftKey, metaKey, button, relatedTarget);
    
    simulatedEvent.initMouseEvent(type, true, true, window, 1, first.screenX, first.screenY, first.clientX, first.clientY,
                                  false, false, false, false, 0, null);
                                                                            
    first.target.dispatchEvent(simulatedEvent);
 
    event.preventDefault();
}

      for(i=0;i<document.getElementById("ordering").childNodes.length;i++) {
        document.getElementById('ordering').childNodes.item(i).addEventListener("touchstart", touchHandler, false);
        document.getElementById('ordering').childNodes.item(i).addEventListener("touchmove", touchHandler, false);
        document.getElementById('ordering').childNodes.item(i).addEventListener("touchend", touchHandler, false);
        document.getElementById('ordering').childNodes.item(i).addEventListener("touchcancel", touchHandler, false);
      }
    },500);
    
}

</script>

<div class="qtext">
  <?php echo $questiontext; ?>
</div>

<?php /*if ($image) { ?>
  <img class="qimage" src="<?php echo $image; ?>" alt="" />
<?php }*/ ?><img class="qimage" src="type/ordering/icon.gif" alt="" />

<div class="ablock clearfix">
  <div class="prompt">
    <?php echo $answerprompt; ?>
  </div>

  <div class="answer">
    <ul id="ordering" class="sortable boxy">
    <?php $row = 1; foreach ($anss as $answer) { ?>
      <li id="<?php echo $answer->id ?>" onMouseUp="getSort_<?php echo $question->id; ?>()"><?php echo $answer->text ?></li>
    <?php } ?>
    </ul>
  </div>
  <?php if ($feedback) { ?>
    <div class="feedback">
      <?php echo $feedback ?>
    </div>
  <?php } ?>
  <input type="hidden" name="<?php echo $question->name_prefix; ?>" id="<?php echo $question->name_prefix; ?>" value="" />
  
  <?php $this->print_question_submit_buttons($question, $state, $cmoptions, $options); ?>
</div>

<iframe frameborder="0" hspace="0" vspace="0" height="1" width="1" onload="onneedrun_<?php echo $question->id; ?>();getSort_<?php echo $question->id; ?>();"></iframe>

<script>init();</script>